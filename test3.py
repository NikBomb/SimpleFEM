import numpy as np
import PlateFEM as pfem
import matplotlib.pyplot as plt

if __name__ == "__main__":
    nodes = np.array([[0,12,24,36,48,
                       0,12,24,36,48,
                       6,6,0,6,12,
                       18,18,18,24,30,
                       30,30,36,42,42,
                       42,48],
                      [0,0,0,0,0,
                       12,12,12,12,12,
                       0,6,6,12,6,
                       0,6,12,6,0,
                       6,12,6,0,6,
                       12,6]])

    connectivity = np.array([[0,12,10],
                             [11,10,12],
                             [12,11,13],
                             [12,5,13],
                             [10,1,11],
                             [1,14,11],
                             [11,13,6],
                             [11,14,6],
                             [14,15,1],
                             [14,16,15],
                             [14,16,17],
                             [14,6,17],
                             [16,15,2],
                             [16,18,2],
                             [16,18,7],
                             [16,17,7],
                             [18,2,19],
                             [18,20,19],
                             [18,20,21],
                             [18,7,21],
                             [20,19,3],
                             [20,22,3],
                             [20,22,8],
                             [20,21,8],
                             [22,3,23],
                             [22,24,23],
                             [22,24,25],
                             [22,25,8],
                             [24,23,4],
                             [24,26,4],
                             [24,26,9],
                             [24,25,9],
                             ])


    # connectivity = np.array([[0,12,10],
    #                             [11,10,12],
    #                             [10,11,1],
    #                             [14,1,11],
    #                             [1,14,15],
    #                             [16,15,14],
    #                             [15,16,2],
    #                             [18,2,16],
    #                             [2,18,19],
    #                             [20,19,18],
    #                             [19,20,3],
    #                             [22,3,20],
    #                             [3,22,23],
    #                             [24,23,22],
    #                             [23,24,4],
    #                             [26,4,24],
    #                             [12,5,11],
    #                             [13,11,5],
    #                             [11,13,14],
    #                             [6,14,13],
    #                             [14,6,16],
    #                             [17,16,6],
    #                             [16,17,18],
    #                             [7,18,17],
    #                              [18,7,20],
    #                              [21,20,7],
    #                              [20,21,22],
    #                              [8,22,21],
    #                              [22,8,24],
    #                              [25,24,8],
    #                              [24,25,26],
    #                              [9,26,25]
    #                             ])

    # connectivity = np.array([[0,12,10],
    #                             [11,10,12],
    #                             [10,14,11],
    #                             [10,14,1],
    #                             [1,14,15],
    #                             [16,15,14],
    #                             [15,18,16],
    #                             [15,2,18],
    #                             [2,18,19],
    #                             [20,19,18],
    #                             [19,22,20],
    #                             [19,3,22],
    #                             [3,22,23],
    #                             [24,23,22],
    #                             [23,26,24],
    #                             [23,4,26],
    #
    #                             [12,13,5],
    #                             [11,13,12],
    #                             [11,13,14],
    #                             [6,14,13],
    #                             [14,17,6],
    #                             [14,16,17],
    #                             [16,17,18],
    #                             [7,18,17],
    #                              [18,21,7],
    #                              [18,20,21],
    #                              [20,21,22],
    #                              [8,22,21],
    #                              [22,25,8],
    #                              [22,24,25],
    #                              [24,25,26],
    #                              [9,26,25]
    #                             ])

    alumininium = pfem.Elastic(30E6, 0.25)
    t = 1.0
    boundaryConditions = {
        "fixed": {0: "all", 5: "all", 12: "all"},
        "applied force": {4: [0, 6.67 * 1000], 9: [0, 6.67 * 1000], 26: [0, 26.67 * 1000]}
    }
    plate = pfem.Body(pfem.createTriangles(connectivity, nodes, alumininium, t), np.shape(nodes)[1])
    plate.assembleGlobalStiffness()
    plate.applyBcs(boundaryConditions)
    plate.solve()

    fig, ax = plt.subplots()
    ax.scatter(nodes[0, :] + plate.sol[0::2], nodes[1, :] + plate.sol[1::2])
    for i in range(np.shape(nodes)[1]):
        ax.annotate(i, (nodes[0, i], nodes[1, i]))
    plt.triplot(nodes[0, :], nodes[1, :], connectivity)
    plt.show()



